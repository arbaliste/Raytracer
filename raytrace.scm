;;; Scheme Recursive Art Contest Entry
;;;
;;; Please do not include your name or personal info in this file.
;;;
;;; Title: <Your title here>
;;;
;;; Description:
;;;   <It's your masterpiece.
;;;    Use these three lines to describe
;;;    its inner meaning.>

; Uncomment for running in racket
#lang racket
(require racket/draw)
(define (screen_width) 150)
(define (screen_height) 150)
(define target (make-bitmap (screen_width) (screen_height)))
(define dc (new bitmap-dc% [bitmap target]))
(define (exitonclick) (send target save-file "output.png" 'png))
(send dc set-pen "" 0 'transparent)
(define (pixel x y color)
 (send dc set-pixel x (- (screen_height) 1 y) color))
(define (rgb r g b)
 (make-object color%
   (exact-round (exact->inexact (* 255 r)))
   (exact-round (exact->inexact (* 255 g)))
   (exact-round (exact->inexact (* 255 b)))))
(define nil '())

; General utils
(define (all l)
  (cond
    ((null? l) #t)
    ((not (car l)) #f)
    (all (cdr l))))
(define (clamp oldmin oldmax newmin newmax val)
  (+ (* (/ (- val oldmin) (- oldmax oldmin)) (- newmax newmin)) newmin))
(define (min a b)
  (if (< a b)
      a
      b))
(define (max a b)
  (if (< a b)
      b
      a))
(define (ntake list n)
    ; Takes n elements from a list and returns (first-n . remaining)
    ; WARNING: Not tail recursive, n shouldn't be large
    (define (iter list n)
      (if (= n 0)
        (cons nil list)
        (let
          ((next (iter (cdr list) (- n 1))))
          (cons
            (cons (car list) (car next))
            (cdr next)))))
    (iter list n))
(define (ngroup list n)
    ; Splits a list into sublists of n elements each
    ; Tail recursive
    (define (iter-reverse prev list)
      (if (null? list)
        prev
        (let
          ((take (ntake list n)))
          (iter-reverse
            (cons (car take) prev)
            (cdr take)))))
    (reverse (iter-reverse nil list)))
(define (loop-range min-val max-val func)
  ; Basically a for loop
  (func min-val)
  (if (< (+ min-val 1) max-val)
      (loop-range (+ min-val 1) max-val func)
      nil))
(define (zip pairs)
  ; Zips multiple lists together
  ; Returns: list of lists
  ; WARNING: Not fail recursive, lists shouldn't be large
  (if (null? pairs)
      '(() ())
      (if (null? (car pairs))
          nil
          (cons (map car pairs) (zip (map cdr pairs))))))
(define (list-index s index)
  ; Gets the element of a list at an index
  ; Returns: (index)th element of l
  (if (= 0 index)
      (car s)
      (list-index (cdr s) (- index 1))))
(define (map procedure s)
  ; Tail-recursive map, from https://cs61a.org/assets/slides/29-Tail_Calls_full.pdf
  (define (map-reverse s m)
    (if (null? s)
      m
      (map-reverse
        (cdr s)
        (cons (procedure (car s)) m))))
  (reverse (map-reverse s nil)))
(define (reverse s)
  ; Tail-recursive reverse, from https://cs61a.org/assets/slides/29-Tail_Calls_full.pdf
  (define (reverse-iter s r)
    (if (null? s)
      r
      (reverse-iter
        (cdr s)
        (cons (car s) r))))
  (reverse-iter s nil))
(define (reduce func s)
  ; Tail-recursive reduce
  (if (null? (cdr s))
    (car s)
    (reduce func
      (cons
        (func (car s) (car (cdr s)))
        (cdr (cdr s))))))
(define (square x) (* x x))
(define (round x)
  (if (>= x 0)
      (floor (+ x 0.5))
      (- (round (- x)))))

; Vectors
; Vector structure: (x y z)
(define vec-create list)
(define (vec-x vec) (list-index vec 0))
(define (vec-y vec) (list-index vec 1))
(define (vec-z vec) (list-index vec 2))
(define (vec-mul v1 scalar) (map (lambda (x) (* x scalar)) v1))
(define (vec-mulvec v1 v2) (map (lambda (x) (reduce * x)) (zip (list v1 v2))))
(define (vec-add v1 v2) (map (lambda (x) (reduce + x)) (zip (list v1 v2))))
(define (vec-sub v1 v2) (vec-add v1 (vec-mul v2 -1)))
(define (vec-dot v1 v2) (reduce + (map (lambda (x) (reduce * x)) (zip (list v1 v2)))))
(define (vec-cross v1 v2) ; Only 3d
  (vec-create
   (- (* (vec-y v1) (vec-z v2)) (* (vec-z v1) (vec-y v2)))
   (- (* (vec-z v1) (vec-x v2)) (* (vec-x v1) (vec-z v2)))
   (- (* (vec-x v1) (vec-y v2)) (* (vec-y v1) (vec-x v2)))))
(define (vec-distsq v1 v2) (reduce + (map (lambda (x) (square (reduce - x))) (zip (list v1 v2)))))
(define (vec-dist v1 v2) (sqrt (vec-distsq v1 v2)))
(define vec-zero (vec-create 0 0 0))
(define (vec-magnitudesq v1) (vec-dot v1 v1))
(define (vec-magnitude v1) (sqrt (vec-magnitudesq v1)))
(define (vec-normalize v1) (vec-mul v1 (/ 1 (vec-magnitude v1))))
(define (vec-colormap vec) (map (lambda (x) (min x 1)) vec))  
(define (vec-rgb vec) (apply rgb vec))

; Rays
(define (ray-create orig dir) (list orig (vec-normalize dir)))
(define (ray-orig ray) (list-index ray 0))
(define (ray-dir ray) (list-index ray 1))

; Objects
; Object structure: (intersect-function properties color reflection)
; Intersect function: determines whether an object intersects with a ray
;   Returns: ray of phit and nhit
;            nil if no intersection
; Properties: list of object type specific attributes
; Color: vec3 (color)
; Reflection: from 0 to 1, amount reflected
(define object-create list)
(define (object-intersect obj) (list-index obj 0))
(define (object-properties obj) (list-index obj 1))
(define (object-color obj) (list-index obj 2))
(define (object-reflection obj) (list-index obj 3))
(define (make-constant-color color)
  (lambda (object point)
    color))
(define (make-checkerboard-color color1 color2 gridsize)
  (lambda (object point)
    (define modvec (map (lambda (p) (modulo (round (/ p gridsize)) 2)) point))
    (define xmod (vec-x modvec))
    (define ymod (vec-y modvec))
    (define zmod (vec-z modvec))
    (if (if (= ymod 0)
          (= xmod zmod)
          (not (= xmod zmod)))
        color1
        color2)))
; Planes
; Plane properties: (p normal)
(define (plane-create p normal color reflection)
  (object-create plane-intersect (list p normal) color reflection))
(define (plane-intersect plane ray)
  (define invnorm (vec-mul (vec-normalize (plane-normal plane)) -1))
  (define point (plane-point plane))
  (define direction (ray-dir ray))
  (define origin (ray-orig ray))
  (define denom (vec-dot invnorm direction))
  (if (<= denom bias)
      nil
      (let
          ((t (/ (vec-dot (vec-sub point origin) invnorm) denom)))
          (if (< t 0)
              nil
              (ray-create (vec-add origin (vec-mul direction t)) (plane-normal plane))))))
(define (plane-point plane)
  (list-index (object-properties plane) 0))
(define (plane-normal plane)
  (list-index (object-properties plane) 1))
; Spheres
; Sphere properties: (radius position)
(define (sphere-create radius vec color reflection)
  (object-create sphere-intersect (list radius vec) color reflection))
(define (sphere-intersect sphere ray)
  ; https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes/ray-sphere-intersection
  (define radius (sphere-radius sphere))
  (define position (sphere-position sphere))
  (define origin (ray-orig ray))
  (define direction (ray-dir ray))
  (define l (vec-sub position origin))
  (define tca (vec-dot l direction))
  (define d2 (- (vec-magnitudesq l) (square tca)))
  (if (or (< tca 0) (> d2 (square radius)))
      nil
      ((lambda () ; Uses lambda because begin in an expression doesn't allow defines in racket
         (define thc (sqrt (- (square radius) d2)))
         (define t0 (- tca thc))
         (define t1 (+ tca thc))
         (define t
           (cond
             ((< t0 0) t1)
             ((< t1 0) t0)
             (else (min t0 t1))))
         (if (< t 0)
             nil
             ((lambda ()
               (define phit (vec-add origin (vec-mul direction t)))
               (define nhit (vec-sub phit position))
               (ray-create phit nhit))))))))
(define (sphere-radius sphere) (list-index (object-properties sphere) 0))
(define (sphere-position sphere) (list-index (object-properties sphere) 1))
; Triangles
; Triangle properties: (p1 p2 p3)
(define (triangle-create p1 p2 p3 color reflection)
  (object-create triangle-intersect (list p1 p2 p3) color reflection))
(define (triangle-intersect triangle ray)
  ; https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-rendering-a-triangle/geometry-of-a-triangle
  ;
  ;    C
  ;   ^  
  ;  /    
  ; A ---> B
  (define origin (ray-orig ray))
  (define direction (ray-dir ray))
  (define a (triangle-p1 triangle))
  (define b (triangle-p2 triangle))
  (define c (triangle-p3 triangle))
  (define AB (vec-sub b a))
  (define AC (vec-sub c a))
  (define normal (vec-cross AB AC))
  (define areasq (vec-magnitudesq normal))
  (define normdotray (vec-dot normal direction))
  (if (< (abs normdotray) bias) ; Remove abs for back culling
      nil
      (let
        ((t (/ (+ (vec-dot normal origin) (vec-dot normal a)) normdotray)))
        (if (< t 0)
            nil
            (let
              ((phit (vec-add origin (vec-mul direction t))))
              (if
               (all
                (map
                 (lambda (p)
                   (define point (car p))
                   (define edge (cdr p))
                   (>= (vec-dot normal (vec-cross edge (vec-sub phit point))) 0))
                 (list
                  (cons a (vec-sub b a))
                  (cons b (vec-sub c b))
                  (cons c (vec-sub a c)))))
              (ray-create phit (vec-normalize normal))
              nil))))))
(define (triangle-p1 triangle) (list-index (object-properties triangle) 0))
(define (triangle-p2 triangle) (list-index (object-properties triangle) 1))
(define (triangle-p3 triangle) (list-index (object-properties triangle) 2))
(define (calculate-bbox points)
  ; Finds the smallest bounding box around a set of points, represented as (min max)
  (list
    (vec-create
      (reduce min (map vec-x points))
      (reduce min (map vec-y points))
      (reduce min (map vec-z points)))
    (vec-create
      (reduce max (map vec-x points))
      (reduce max (map vec-y points))
      (reduce max (map vec-z points)))))
(define (bbox-intersect? bbox ray)
  ; Checks if a bounding box intersects with a ray, returns a BOOLEAN (NOT standard intersect function)
  ; https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes/ray-box-intersection
  ; TODO
  #t)
(define (mesh-create points color reflection)
  ; Creates a mesh from a list of triangle vertex positions
  (define triangles
    (map
      (lambda (vertices)
        (triangle-create (list-index vertices 0) (list-index vertices 1) (list-index vertices 2) color reflection))
      (ngroup points 3)))
  (define bbox (calculate-bbox points))
  (object-create mesh-intersect (list triangles bbox) color reflection))
(define (mesh-intersect mesh ray)
  ; Checks for intersection with bounding box for optimization
  ; If passed, checks for intersection with any of the triangles
  (if (not (bbox-intersect? (mesh-bbox mesh) ray))
      nil
      (let
        ((intersect (ray-closest ray (mesh-triangles mesh))))
        (if (null? intersect)
          nil
          (list-index intersect 1)))))
(define (mesh-triangles mesh) (list-index (object-properties mesh) 0))
(define (mesh-bbox mesh) (list-index (object-properties mesh) 1))

; Num encoding
(define (num-to-list num pow)
  ; Converts num to a list of its segments of 10**pow
  ; WARNING: Requires python scheme builtin quotient to use // instead of / 
  (define pow10 (expt 10 pow))
  (define (iter-reverse num prev)
    (if (= num 0)
      prev
      (iter-reverse (quotient num pow10) (cons (modulo num pow10) prev))))
  (iter-reverse num nil))
(define (num-to-coords num)
  ; Converts an encoded number to a list of vec coords
  ; Groups of 9 represent numbers
  ; 3 groups of numbers represent a vec

  ; 1-2 - Tens and ones
  ; 3-8 - Decimal digits
  ; 9   - Sign: 1 = positive, 2 = negative
  (ngroup
    (map
      (lambda (d)
        (define sign
          (if (= 1 (modulo d 10))
            1
            -1))
        (define num (quotient d 10))
        (* sign num (/ (expt 10 6)))
      )
      (num-to-list num 9))
    3))

; Raytracing
(define (ray-closest ray objects)
  ; Find closest object intersecting with a ray
  ; Returns: (distance^2: number, hit: ray, object: object)
  ; Returns nil if nothing hit
  (reduce
     (lambda (o1 o2)
         (cond
           ((null? o1) o2)
           ((null? o2) o1)
           ((> (list-index o1 0) (list-index o2 0)) o2)
           (else o1)))
     (map
      (lambda (object)
        (define intersect ((object-intersect object) object ray))
        (if (null? intersect)
            nil
            (list (vec-distsq (ray-orig intersect) (ray-orig ray)) intersect object)))
      objects)))
(define (get-brightness hit)
  ; Gets brightness as a function of hit position, hit normal, light position, and light intensity
  ; https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-shading/shading-spherical-light
  ; Returns: number from 0 to 1
  (*
    light-intensity
    (max 0 (vec-dot (ray-dir hit) (vec-normalize (vec-sub light-pos (ray-orig hit)))))))      ; Angle between nhit and -lightdir
(define (get-reflect dir nhit)
  ; Get a reflection direction from a direction and normal
  ; https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-shading/reflection-refraction-fresnel
  (vec-sub dir (vec-mul nhit (* 2 (vec-dot dir nhit)))))
(define (ray-trace depth ray)
  ; Traces a ray into the scene
  ; Returns: vec3 (color)
  (define closest (ray-closest ray objects))
  (if (or (null? closest) (> depth max-depth))                           ; If no object, use sky color
      (sky-color ray)
      ((lambda ()
          (define hit (list-index closest 1))
          (define object (list-index closest 2))
          (define phit (ray-orig hit))
          (define nhit (ray-dir hit))
          (define reflect-component
               (if (> (vec-magnitudesq (object-reflection object)) 0)                          ; If reflects, recurse with reflection and multiply by reflection amount
                 (vec-mulvec
                   (ray-trace (+ depth 1) (ray-create phit (get-reflect (ray-dir ray) nhit)))
                   (object-reflection object))
                 vec-zero))
          (define shadow-closest ; If object hit, cast shadow ray and calculate brightness if not in shadow
                    (ray-closest (ray-create
                                  phit
                                  (vec-sub light-pos phit)) objects))                           ; TODO: Add bias?
          (define diffuse-component
            (if (or                                                   ; If no intersecting object with shadow ray or object is beyond light, illuminate
                 (null? shadow-closest)
                 (> (square (list-index shadow-closest 0)) (vec-distsq phit light-pos)))
               (vec-mul ((object-color object) object phit) (get-brightness hit))
               vec-zero)) ; Otherwise, black
          (vec-colormap (vec-add reflect-component diffuse-component))))))                                       
(define (pixel-trace x y)
  ; Get pixel color at (x, y) by casting rays
  ; Returns: vec3 (color)
  (define lookdir (vec-normalize (vec-sub camera-lookat camera-pos)))
  (define upvec (vec-normalize camera-up))
  (define rightvec (vec-normalize (vec-cross lookdir upvec)))
  (if (not (= 0 (vec-dot upvec lookdir))) (/ 1 0) 1) ; Break if up vector isn't perpendicular to look direction

  (define screen-height
    (* 2
     (vec-dist camera-pos camera-lookat)
     (tan (* camera-fov pi (/ 360)))))
  (define scale (/ screen-height (screen_height))) ; Units per pixel
  (define yoffset (- y (/ (screen_height) 2) -0.5)) ; Offset in pixels from camera lookat. Y is not flipped because turtle graphics 0 is bottom
  (define xoffset (- x (/ (screen_width) 2) -0.5))
  (define screen-pos
    (vec-add
      (vec-add
       (vec-mul upvec (* scale yoffset))
       (vec-mul rightvec (* scale xoffset)))
      camera-lookat))
  (ray-trace 0 (ray-create
    camera-pos
    (vec-sub screen-pos camera-pos))))

; Setup
(define pi 3.141592653589793)
(define bias 0.0001)
(define max-depth 5)
(define camera-pos (vec-create 0 20 50))
(define camera-lookat (vec-create 0 0 0))
(define camera-up (vec-cross (vec-sub camera-lookat camera-pos) (vec-create -1 0 0)))
(define camera-fov 90)
(define light-pos (vec-create 0 30 30))
(define light-intensity 1)
(define (sky-color ray)
  (vec-create 0 0 0))
(define meshes '( ; Go bEaRs! üíõüêªüíô
  ; bear-leg4
  067274712033096242134982511074614772014195442039374801041973142005567432042312051074614772014195442039374801093570182045818382018218851041973142005567432042312051093570182045818382018218851033940112047072542005804711041973142005567432042312051033214752053919141130980111029598152007526762136541121041973142005567432042312051067274712033096242134982511041973142005567432042312051029598152007526762136541121099733102028516901003176731062513452067899301144874381057669132052531351003080081028166372023144411000979081057669132052531351003080081062513452067899301144874381028166372023144411000979081062513452067899301144874381033214752053919141130980111033214752053919141130980111041973142005567432042312051028166372023144411000979081099733102028516901003176731033940112047072542005804711073374882055178962005808861033940112047072542005804711028166372023144411000979081041973142005567432042312051099733102028516901003176731057669132052531351003080081028166372023144411000979081099733102028516901003176731028166372023144411000979081033940112047072542005804711099733102028516901003176731094972462062129391182143671062513452067899301144874381122012502032769552251768741099733102028516901003176731067274712033096242134982511074614772014195442039374801067274712033096242134982511099733102028516901003176731099733102028516901003176731073374882055178962005808861093570182045818382018218851099733102028516901003176731093570182045818382018218851074614772014195442039374801093570182045818382018218851073374882055178962005808861033940112047072542005804711099733102028516901003176731122012502032769552251768741094972462062129391182143671
  ; bear-head
  078980452211204452276306591061052362177289302311527441041710482160887282220055521070461592264648232296969831070995902215498012319063931078980452211204452276306591027499101292382972323922201018018812307128832289948601024672731293760262305165811018018812307128832289948601031985272286177182329121441070461592264648232296969831018018812307128832289948601070461592264648232296969831042308792288354912261885071070461592264648232296969831078980452211204452276306591066381732230031722245311341042308792288354912261885071070461592264648232296969831039695512245616822226918851039695512245616822226918851070461592264648232296969831066381732230031722245311341018018812307128832289948601042308792288354912261885071012375242347482912257553731041710482160887282220055521019472521242534812218429851039695512245616822226918851078980452211204452276306591041710482160887282220055521066381732230031722245311341041710482160887282220055521039695512245616822226918851066381732230031722245311341039695512245616822226918851017090262335721632235261081042308792288354912261885071076734711210924402277533071066189411223225842324988061070260541259710772284966581076734711210924402277533071054709141148370202236158581066189411223225842324988061066189411223225842324988061054709141148370202236158581055980541167957192307874321054709141148370202236158581076734711210924402277533071045126121225480712224981211027499101292382972323922201031985272286177182329121441018018812307128832289948601024672731293760262305165811070260541259710772284966581027499101292382972323922201018230001152870002360099981030736121196205082364061621057997381185878302339814001058833601215887642376171041075878171218461512358799781057997381185878302339814001030736121196205082364061621058833601215887642376171041057997381185878302339814001012680002158900002362169991030736121196205082364061621018230001152870002360099981055980541167957192307874321057997381185878302339814001075878171218461512358799781033878741232628542362143401066189411223225842324988061058833601215887642376171041058833601215887642376171041066189411223225842324988061075878171218461512358799781024672731293760262305165811012375242347482912257553731014916321339344642240433161055980541167957192307874321075878171218461512358799781066189411223225842324988061070260541259710772284966581066189411223225842324988061033878741232628542362143401024672731293760262305165811018018812307128832289948601012375242347482912257553731030736121196205082364061621033878741232628542362143401058833601215887642376171041070260541259710772284966581033878741232628542362143401027499101292382972323922201030057981165581972222443831019472521242534812218429851041710482160887282220055521039863432180891782354895171077814182208134402346522751057174532212812632374464041019472521242534812218429851045126121225480712224981211070260541259710772284966581045126121225480712224981211076734711210924402277533071070260541259710772284966581019472521242534812218429851030057981165581972222443831045126121225480712224981211045126121225480712224981211030057981165581972222443831054709141148370202236158581037692172230787682361959691012680002158900002362169991039863432180891782354895171033878741232628542362143401030736121196205082364061621012680002158900002362169991037692172230787682361959691033878741232628542362143401012680002158900002362169991066800162223110752365107191037692172230787682361959691057174532212812632374464041057174532212812632374464041037692172230787682361959691039863432180891782354895171077814182208134402346522751066800162223110752365107191057174532212812632374464041034610001282470002243020001024672731293760262305165811014916321339344642240433161070260541259710772284966581024672731293760262305165811034610001282470002243020001070260541259710772284966581034610001282470002243020001019472521242534812218429851019472521242534812218429851017090262335721632235261081039695512245616822226918851034610001282470002243020001014916321339344642240433161019472521242534812218429851014916321339344642240433161017090262335721632235261081019472521242534812218429851070461592264648232296969831037692172230787682361959691070995902215498012319063931070995902215498012319063931037692172230787682361959691066800162223110752365107191039863432180891782354895171061052362177289302311527441077814182208134402346522751070995902215498012319063931066800162223110752365107191077814182208134402346522751061052362177289302311527441070995902215498012319063931077814182208134402346522751070995902215498012319063931061052362177289302311527441078980452211204452276306591033878741232628542362143401031985272286177182329121441027499101292382972323922201033878741232628542362143401037692172230787682361959691031985272286177182329121441037692172230787682361959691070461592264648232296969831031985272286177182329121441018230001152870002360099981057997381185878302339814001055980541167957192307874321042308792288354912261885071017090262335721632235261081012375242347482912257553731017090262335721632235261081014916321339344642240433161012375242347482912257553731
  ; bear-torso
  014846812312043021340823901046570002188340001362210011016110361280185621364783941046570002188340001362210011088023382021443441334556351011261922034196842381702311046570002188340001362210011011261922034196842381702311016110361280185621364783941091855531020717962123928431119842191027704012256219061090012251062588412329576871044933891035052802150734051091855531020717962123928431090012251062588412329576871006352382137850731112853721084133341129932771155132791079134281066770241165911371070136061067679421148072201006352382137850731112853721079134281066770241165911371044933891035052802150734051030057981165581972222443831029598152007526762136541121030057981165581972222443831044933891035052802150734051054709141148370202236158581054709141148370202236158581044933891035052802150734051090012251062588412329576871016110361280185621364783941096346061203703081288218381035417411335790821265897061096346061203703081288218381087000791299830381196247621035417411335790821265897061014846812312043021340823901016110361280185621364783941035417411335790821265897061096346061203703081288218381016110361280185621364783941057450001194300001352210011014846812312043021340823901035417411335790821265897061086755982306213491251967241062513452067899301144874381069920562187642141148030251006352382137850731112853721095489642232541201292250441014846812312043021340823901086755982306213491251967241079134281066770241165911371101085611047261771141411481070136061067679421148072201046570002188340001362210011014846812312043021340823901095489642232541201292250441071920002095920002323079991122012502032769552251768741066365082088787302203488581061052362177289302311527441071920002095920002323079991066365082088787302203488581012680002158900002362169991011261922034196842381702311071920002095920002323079991037502031055505691129764211025685581019799441130947261033214752053919141130980111006352382137850731112853721070136061067679421148072201037502031055505691129764211122012502032769552251768741067274712033096242134982511066365082088787302203488581006352382137850731112853721037502031055505691129764211033214752053919141130980111067274712033096242134982511029598152007526762136541121066365082088787302203488581025685581019799441130947261044933891035052802150734051029598152007526762136541121030057981165581972222443831041710482160887282220055521066365082088787302203488581030057981165581972222443831066365082088787302203488581029598152007526762136541121066365082088787302203488581041710482160887282220055521061052362177289302311527441060881962314285371201267971035417411335790821265897061033687391308908291147901941060881962314285371201267971033687391308908291147901941001686642267959161124364311033214752053919141130980111025685581019799441130947261029598152007526762136541121060881962314285371201267971086755982306213491251967241035417411335790821265897061095489642232541201292250441086755982306213491251967241069920562187642141148030251096346061203703081288218381057450001194300001352210011099495611034045071277651711062513452067899301144874381006352382137850731112853721033214752053919141130980111099495611034045071277651711057450001194300001352210011090012251062588412329576871062513452067899301144874381094972462062129391182143671069920562187642141148030251011261922034196842381702311057450001194300001352210011016110361280185621364783941011261922034196842381702311088023382021443441334556351071920002095920002323079991018230001152870002360099981011261922034196842381702311012680002158900002362169991039863432180891782354895171012680002158900002362169991071920002095920002323079991011261922034196842381702311090012251062588412329576871057450001194300001352210011011261922034196842381702311018230001152870002360099981090012251062588412329576871084133341129932771155132791096346061203703081288218381099495611034045071277651711084133341129932771155132791078259461197548181162346951096346061203703081288218381101085611047261771141411481099495611034045071277651711119842191027704012256219061091855531020717962123928431101085611047261771141411481119842191027704012256219061099495611034045071277651711101085611047261771141411481079134281066770241165911371099495611034045071277651711079134281066770241165911371084133341129932771155132791071920002095920002323079991061052362177289302311527441039863432180891782354895171122012502032769552251768741088023382021443441334556351094972462062129391182143671069920562187642141148030251028384262201223911126112111006352382137850731112853721088023382021443441334556351046570002188340001362210011095489642232541201292250441088023382021443441334556351122012502032769552251768741071920002095920002323079991088023382021443441334556351095489642232541201292250441106509112120623161255694271095489642232541201292250441069920562187642141148030251106509112120623161255694271106509112120623161255694271094972462062129391182143671088023382021443441334556351106509112120623161255694271069920562187642141148030251094972462062129391182143671033687391308908291147901941035417411335790821265897061087000791299830381196247621099495611034045071277651711090012251062588412329576871119842191027704012256219061054709141148370202236158581090012251062588412329576871055980541167957192307874321090012251062588412329576871018230001152870002360099981055980541167957192307874321078259461197548181162346951084133341129932771155132791022650231203822151127687911084133341129932771155132791006352382137850731112853721022650231203822151127687911028384262201223911126112111022650231203822151127687911006352382137850731112853721028384262201223911126112111001686642267959161124364311022650231203822151127687911
  ; bear-leg2
  074321202252358681041010421061792872196858881010378781052552172242361681047568021074321202252358681041010421089389382218448031007474451061792872196858881010378781060881962314285371201267971001686642267959161124364311032035682307602481024335941086755982306213491251967241060881962314285371201267971077358602285202471003013351077358602285202471003013351074321202252358681041010421086755982306213491251967241074321202252358681041010421069920562187642141148030251086755982306213491251967241028384262201223911126112111052552172242361681047568021031393722259841711045185181028384262201223911126112111074321202252358681041010421052552172242361681047568021031393722259841711045185181001686642267959161124364311028384262201223911126112111001686642267959161124364311031393722259841711045185181032035682307602481024335941032035682307602481024335941077358602285202471003013351060881962314285371201267971032035682307602481024335941031393722259841711045185181019775392257135141000422352019775392257135141000422352077358602285202471003013351032035682307602481024335941077358602285202471003013351061792872196858881010378781089389382218448031007474451024044962209812601007665031077358602285202471003013351019775392257135141000422352077358602285202471003013351089389382218448031007474451074321202252358681041010421074321202252358681041010421028384262201223911126112111069920562187642141148030251031393722259841711045185181061792872196858881010378781024044962209812601007665031024044962209812601007665031061792872196858881010378781077358602285202471003013351019775392257135141000422352031393722259841711045185181024044962209812601007665031031393722259841711045185181052552172242361681047568021061792872196858881010378781
  ; bear-leg1
  018341581256888051001599381036085161313807111024047091077270601282218971008566801088946691222130181005683521077270601282218971008566801055376371241262741046266161088946691222130181005683521055376371241262741046266161061197871197660031012224521077270601282218971008566801087000791299830381196247621096346061203703081288218381023286321212603091006168141061197871197660031012224521055376371241262741046266161088946691222130181005683521061197871197660031012224521023286321212603091006168141055376371241262741046266161028626551258123631049675221023286321212603091006168141028626551258123631049675221018341581256888051001599381023286321212603091006168141077270601282218971008566801088946691222130181005683521023286321212603091006168141023286321212603091006168141018341581256888051001599381077270601282218971008566801096346061203703081288218381078259461197548181162346951077270601282218971008566801033687391308908291147901941036085161313807111024047091001686642267959161124364311078259461197548181162346951022650231203822151127687911055376371241262741046266161055376371241262741046266161022650231203822151127687911028626551258123631049675221078259461197548181162346951055376371241262741046266161077270601282218971008566801033687391308908291147901941087000791299830381196247621036085161313807111024047091036085161313807111024047091087000791299830381196247621077270601282218971008566801036085161313807111024047091028626551258123631049675221001686642267959161124364311028626551258123631049675221022650231203822151127687911001686642267959161124364311028626551258123631049675221036085161313807111024047091018341581256888051001599381
  ; bear-leg3
  044933891035052802150734051044373111011391682041626691091855531020717962123928431101085611047261771141411481091855531020717962123928431095277781021773471008159001093355781046569192012920571095277781021773471008159001083006331009776772032576431101085611047261771141411481095277781021773471008159001070136061067679421148072201091855531020717962123928431083006331009776772032576431095277781021773471008159001057299961052361231002319541095277781021773471008159001093355781046569192012920571070136061067679421148072201095277781021773471008159001057299961052361231002319541057299961052361231002319541037502031055505691129764211070136061067679421148072201044373111011391682041626691025685581019799441130947261025406531018944261000524131025685581019799441130947261044373111011391682041626691044933891035052802150734051037502031055505691129764211057299961052361231002319541025406531018944261000524131025406531018944261000524131025685581019799441130947261037502031055505691129764211083006331009776772032576431091855531020717962123928431044373111011391682041626691093355781046569192012920571083006331009776772032576431044373111011391682041626691057299961052361231002319541093355781046569192012920571058534461058945732005552711057299961052361231002319541058534461058945732005552711025406531018944261000524131025406531018944261000524131058534461058945732005552711044373111011391682041626691093355781046569192012920571044373111011391682041626691058534461058945732005552711
))
(define objects
  (append
    (list ; Normal objects
      (plane-create (vec-create 0 0 0) (vec-create 0 1 0) (make-checkerboard-color (vec-create 0.3 0.3 0.3) (vec-create 0.5 0.5 0.5) 10) (vec-create 0.7 0.7 0.7))
      (sphere-create 5 (vec-create -10 5 20) (make-constant-color (vec-create 0 0.196 0.3943)) vec-zero)
      (sphere-create 5 (vec-create 5 5 15) (make-constant-color (vec-create 0.2 0.2 0.2)) (vec-create 0.8 0.8 0.8))
      (sphere-create 10 (vec-create 15 10 0) (make-constant-color (vec-create 0.9922 0.7098 0.0824)) vec-zero)
      (triangle-create (vec-create 15 15 15) (vec-create 30 15 15) (vec-create 15 25 15) (make-constant-color (vec-create 1 0 0)) vec-zero))
    nil));(map ; Mesh objects
    ;  (lambda (num)
    ;    (define coords (num-to-coords num))
    ;    (display "Found ")
    ;    (display (/ (length coords) 3))
    ;    (display " faces\n")
    ;    mesh-create coords (make-constant-color (vec-create 1 0 0)) 0))
    ;  meshes)))

; Main draw function
(define (draw)
  (display "Starting draw\n")
  ; Loops over all the pixels in the image and sets each one's color
  (loop-range 0 (screen_width)
    (lambda (x)
      (loop-range 0 (screen_height)
        (lambda (y)
          (pixel x y (vec-rgb (pixel-trace x y)))))
      (display (quotient (* 100 x) (screen_width)))
      (display "%\n")))
  (exitonclick))

; Please leave this last line alone.  You may add additional procedures above
; this line.
(draw)
